# Список всех команд бота

## Основные команды

### 1. `/start` или `/menu`
- **Описание**: Главное меню бота
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 2. `/list`
- **Описание**: Показать список непросмотренных фильмов
- **Аргументы**: Нет
- **Ожидает ответ**: Да (ID фильмов для отметки как просмотренные)
- **Состояние**: `user_list_state` (для отметки просмотренных)
- **Статус**: ✅ Перенесено

### 3. `/stats`
- **Описание**: Детальная статистика группы и участников
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 4. `/admin_stats`
- **Описание**: Статистика бота (только для создателя)
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 5. `/join`
- **Описание**: Добавить участников группы к участию в боте
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 6. `/total`
- **Описание**: Расширенная статистика (фильмы, жанры, режиссёры, актёры, оценки)
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 7. `/search`
- **Описание**: Поиск фильмов через Kinopoisk API
- **Аргументы**: Нет (но может принимать запрос как аргумент)
- **Ожидает ответ**: Да (текст запроса для поиска)
- **Состояние**: `user_search_state`
- **Статус**: ✅ Перенесено

### 8. `/schedule`
- **Описание**: Показать список запланированных просмотров
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 9. `/random`
- **Описание**: Выбрать случайный непросмотренный фильм с фильтрами
- **Аргументы**: Нет
- **Ожидает ответ**: Нет (но может планировать фильм из результата)
- **Статус**: ✅ Перенесено

### 10. `/rate`
- **Описание**: Оценить просмотренные фильмы
- **Аргументы**: 
  - Без аргументов: показывает список фильмов для оценки
  - С аргументами: `/rate <link/id> <rating>` - сразу ставит оценку
- **Ожидает ответ**: Да (число от 1 до 10 в ответ на сообщение с фильмом)
- **Состояние**: Нет (использует реплаи на сообщения)
- **Статус**: ✅ Перенесено (с аргументами)

### 11. `/settings`
- **Описание**: Настройки бота (эмодзи, часовой пояс, напоминания, импорт)
- **Аргументы**: Нет
- **Ожидает ответ**: Да (эмодзи для реакций, время для напоминаний, user_id для импорта)
- **Состояние**: `user_settings_state`
- **Статус**: ✅ Перенесено

### 12. `/seasons`
- **Описание**: Просмотр сезонов сериалов
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 13. `/help`
- **Описание**: Помощь по командам бота
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 14. `/premieres`
- **Описание**: Просмотр премьер фильмов
- **Аргументы**: Нет
- **Ожидает ответ**: Нет
- **Статус**: ✅ Перенесено

### 15. `/clean`
- **Описание**: Удалить оценку, просмотр, план или обнулить базу
- **Аргументы**: Нет
- **Ожидает ответ**: Да (подтверждение "ДА, УДАЛИТЬ")
- **Состояние**: `user_clean_state`
- **Статус**: ✅ Перенесено

### 16. `/edit`
- **Описание**: Редактирование расписания и оценок
- **Аргументы**: Нет
- **Ожидает ответ**: Да (новая оценка, новое время, ссылки на фильмы для удаления)
- **Состояние**: `user_edit_state`
- **Статус**: ✅ Перенесено

### 17. `/ticket`
- **Описание**: Работа с билетами в кино
- **Аргументы**: Нет
- **Ожидает ответ**: Да (название мероприятия, дата/время, файл билета)
- **Состояние**: `user_ticket_state`
- **Статус**: ✅ Перенесено

### 18. `/payment`
- **Описание**: Управление подписками
- **Аргументы**: Нет
- **Ожидает ответ**: Да (username для подписки, подтверждение отмены "ДА, ОТМЕНИТЬ")
- **Состояние**: `user_payment_state`, `user_cancel_subscription_state`
- **Статус**: ✅ Перенесено

### 19. `/plan`
- **Описание**: Запланировать просмотр фильма (дома/в кино)
- **Аргументы**: 
  - Без аргументов: интерактивный режим
  - С аргументами: `/plan <link> <type> <date>` - сразу планирует
- **Ожидает ответ**: Да (ссылка/ID фильма, тип просмотра, день/дата)
- **Состояние**: `user_plan_state`
- **Статус**: ✅ Перенесено (с аргументами)

### 20. `/unsubscribe`
- **Описание**: Отмена подписки пользователя или группы (только для владельца)
- **Аргументы**: Нет
- **Ожидает ответ**: Да (ID пользователя или группы)
- **Состояние**: `user_unsubscribe_state`
- **Статус**: ✅ Перенесено

### 21. `/refund_stars` (в `/stats`)
- **Описание**: Возврат звезд за операцию
- **Аргументы**: Нет
- **Ожидает ответ**: Да (charge_id операции)
- **Состояние**: `user_refund_state`
- **Статус**: ✅ Перенесено

## Команды с аргументами

### `/rate <link/id> <rating>`
- **Пример**: `/rate https://www.kinopoisk.ru/film/81682/ 10`
- **Пример**: `/rate 81682 10`
- **Описание**: Сразу ставит оценку фильму без интерактивного режима
- **Статус**: ✅ Реализовано

### `/plan <link> <type> <date>`
- **Пример**: `/plan https://www.kinopoisk.ru/film/81682/ дома сегодня 10:00`
- **Описание**: Сразу планирует просмотр фильма без интерактивного режима
- **Статус**: ✅ Реализовано

## Состояния, где ожидается ответ от пользователя

### 1. `user_ticket_state`
- **Шаги**:
  - `waiting_new_session`: ожидает название фильма и дату
  - `event_name`: ожидает название мероприятия
  - `event_datetime`: ожидает дату и время мероприятия
  - `upload_ticket`: ожидает файл билета
  - `waiting_session_time`: ожидает время сеанса
- **Статус**: ✅ Перенесено

### 2. `user_search_state`
- **Шаги**:
  - Ожидает текст запроса для поиска
- **Статус**: ✅ Перенесено

### 3. `user_import_state`
- **Шаги**:
  - `waiting_user_id`: ожидает user_id или ссылку на профиль Кинопоиска
- **Статус**: ✅ Перенесено

### 4. `user_edit_state`
- **Действия**:
  - `edit_rating`: ожидает новую оценку (1-10)
  - `edit_plan_datetime`: ожидает новую дату и время
  - `delete_movie`: ожидает ссылки или ID фильмов для удаления
- **Статус**: ✅ Перенесено

### 5. `user_settings_state`
- **Действия**:
  - `adding_reactions`: ожидает эмодзи для реакций
  - `waiting_notify_time`: ожидает время для напоминаний (формат ЧЧ:ММ)
- **Статус**: ✅ Перенесено

### 6. `user_view_film_state`
- **Описание**: Ожидает ссылку или ID фильма для просмотра описания
- **Статус**: ✅ Перенесено

### 7. `user_plan_state`
- **Шаги**:
  - `step=1`: ожидает ссылку или ID фильма
  - `step=2`: ожидает тип просмотра (дома/кино)
  - `step=3`: ожидает день/дату просмотра
- **Статус**: ✅ Перенесено

### 8. `user_clean_state`
- **Описание**: Ожидает подтверждение "ДА, УДАЛИТЬ"
- **Статус**: ✅ Перенесено

### 9. `user_cancel_subscription_state`
- **Описание**: Ожидает подтверждение "ДА, ОТМЕНИТЬ"
- **Статус**: ✅ Перенесено

### 10. `user_payment_state`
- **Описание**: Ожидает username для подписки
- **Статус**: ✅ Перенесено

### 11. `user_refund_state`
- **Описание**: Ожидает charge_id для возврата
- **Статус**: ✅ Перенесено

### 12. `user_unsubscribe_state`
- **Описание**: Ожидает ID пользователя или группы
- **Статус**: ✅ Перенесено

### 13. `user_list_state`
- **Описание**: Ожидает ID фильмов для отметки как просмотренные
- **Статус**: ✅ Перенесено

## Реплаи на сообщения бота

### 1. Реплай на сообщение с оценками (`/rate`)
- **Ожидает**: Число от 1 до 10
- **Статус**: ✅ Перенесено

### 2. Реплай на список фильмов (`/list`)
- **Ожидает**: ID фильмов (через пробел или запятую)
- **Статус**: ✅ Перенесено

### 3. Реплай на сообщение с фильмом из `/random`
- **Ожидает**: Текст с типом просмотра и датой для планирования
- **Статус**: ✅ Перенесено

### 4. Реплай на сообщение с ошибкой планирования
- **Ожидает**: Исправленные данные (тип просмотра или дату)
- **Статус**: ✅ Перенесено

### 5. Реплай на сообщение с фильмом для оценки
- **Ожидает**: Число от 1 до 10
- **Статус**: ✅ Перенесено

### 6. Реплай на голосование "в кино"
- **Ожидает**: "да" или "нет"
- **Статус**: ✅ Перенесено

### 7. Реплай на сообщение "Добавлено в базу"
- **Ожидает**: Число от 1 до 10 для оценки
- **Статус**: ✅ Перенесено

### 8. Реплай на сообщение промокода
- **Ожидает**: Текст промокода
- **Статус**: ✅ Перенесено

## Проверка переноса

### Команды, требующие проверки:
- ✅ Все команды перенесены
- ✅ Все команды с аргументами реализованы
- ✅ Все состояния перенесены
- ✅ Все реплаи обрабатываются

### Важные моменты:
1. **Команды должны обрабатываться только без реплая** - добавлена проверка `func=lambda m: not m.reply_to_message` для `/list`, `/rate`, `/plan`
2. **Все текстовые ответы должны быть только в реплаях** - реализовано через проверку `message.reply_to_message` и `prompt_message_id`
3. **Команды с аргументами работают напрямую** - `/rate <link> <rating>` и `/plan <link> <type> <date>` обрабатываются сразу

