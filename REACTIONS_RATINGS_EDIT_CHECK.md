# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–∫—Ü–∏–π, –æ—Ü–µ–Ω–æ–∫, —Ç–∞–π–º–∏–Ω–≥–æ–≤ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚ùå –†–µ–∞–∫—Ü–∏–∏-—ç–º–æ–¥–∑–∏ –Ω–∞ –∑–∞–ø–∏—Å–∏ —Å —Ñ–∏–ª—å–º–∞–º–∏ - –ù–ï –ü–ï–†–ï–ù–ï–°–ï–ù–´

### –ü—Ä–æ–±–ª–µ–º–∞:
- ‚ùå **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `@bot.message_reaction_handler` –ù–ï –ü–ï–†–ï–ù–ï–°–ï–ù**
- –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ: `moviebot.py.OLD_DO_NOT_USE` —Å—Ç—Ä–æ–∫–∞ 4525
- –õ–æ–≥–∏–∫–∞:
  1. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–∏–ª—å–º–æ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–º–æ–¥–∑–∏ "watched" —ç–º–æ–¥–∑–∏
  2. –ï—Å–ª–∏ —ç–º–æ–¥–∑–∏ –Ω–µ –≤ —Å–ø–∏—Å–∫–µ watched, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫, –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ
  3. –ï—Å–ª–∏ —ç–º–æ–¥–∑–∏ –≤ —Å–ø–∏—Å–∫–µ watched, —Ñ–∏–ª—å–º –æ—Ç–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π
  4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —ç–º–æ–¥–∑–∏ (custom_emoji_id)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏:
- `handle_reaction` —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 4525-4873 –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è settings (–¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–º–æ–¥–∑–∏)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ñ–∏–ª—å–º–∞–º–∏ (–¥–ª—è –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π)
- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–∑–Ω–∞–∫–æ–º—ã–π —ç–º–æ–¥–∑–∏ –∞–∫—Ç–∏–≤–Ω—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
- Callback `add_emoji:` –∏ `add_custom_emoji:` –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

## ‚ö†Ô∏è –§–ª–æ—É –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫ - –ß–ê–°–¢–ò–ß–ù–û –ü–ï–†–ï–ù–ï–°–ï–ù–û

### –ß—Ç–æ –µ—Å—Ç—å:
- ‚úÖ `rating_messages` —Å–ª–æ–≤–∞—Ä—å –≤ `moviebot/states.py`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û—Ü–µ–Ω–∏—Ç—å" –≤ `series_callbacks.py` (—Å—Ç—Ä–æ–∫–∞ 641)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `message_id` –≤ `rating_messages` –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –æ—Ü–µ–Ω–∫–∏

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
- ‚ùå **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –ù–ï –ü–ï–†–ï–ù–ï–°–ï–ù**
- –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ: `handle_rating_internal` (—Å—Ç—Ä–æ–∫–∞ 6007) –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (—Å—Ç—Ä–æ–∫–∞ 6753)
- –õ–æ–≥–∏–∫–∞:
  1. –ü—Ä–æ–≤–µ—Ä–∫–∞ `message.reply_to_message` –∏ –ø–æ–∏—Å–∫ `film_id` –≤ `rating_messages` –∏–ª–∏ `bot_messages`
  2. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ —Ü–µ–ø–æ—á–∫–µ —Ä–µ–ø–ª–∞–µ–≤
  3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏ –≤ –ë–î
  4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —Ñ–∏–ª—å–º–∞ –∫–∞–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ, –µ—Å–ª–∏ –Ω–µ –±—ã–ª –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω
  5. –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—Å–µ –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ü–µ–Ω–∏–ª–∏ (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏)
  6. –ü–æ–∫–∞–∑ –ø–æ—Ö–æ–∂–∏—Ö —Ñ–∏–ª—å–º–æ–≤ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ >= 9

### –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `rating_messages` –∏ `bot_messages`
- –§—É–Ω–∫—Ü–∏—è `handle_rating_internal` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞

## ‚ö†Ô∏è –¢–∞–π–º–∏–Ω–≥–∏ (–æ—Ç–≤–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∑–∞–ø—Ä–æ—Å –æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—Ä–µ–º–µ–Ω–∏) - –ß–ê–°–¢–ò–ß–ù–û –ü–ï–†–ï–ù–ï–°–ï–ù–û

### –ß—Ç–æ –µ—Å—Ç—å:
- ‚úÖ `user_settings_state` –≤ `moviebot/states.py`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ `waiting_notify_time` –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ (—Å—Ç—Ä–æ–∫–∞ 6588)

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
- ‚ùå **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ù–ï –ü–ï–†–ï–ù–ï–°–ï–ù**
- –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (—Å—Ç—Ä–æ–∫–∏ 6588-6647)
- –õ–æ–≥–∏–∫–∞:
  1. –ü—Ä–æ–≤–µ—Ä–∫–∞ `user_settings_state[user_id].get('waiting_notify_time')`
  2. –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ß–ß:–ú–ú
  3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `set_notification_setting` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ (`home`, `cinema`, `home_weekday`, `home_weekend`, `cinema_weekday`, `cinema_weekend`)

### –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `waiting_notify_time` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ù–æ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (—Å–º. NOTIFICATIONS_CHECK.md)

## ‚úÖ –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ/—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è - –ü–ï–†–ï–ù–ï–°–ï–ù–û

### –ß—Ç–æ –µ—Å—Ç—å:
- ‚úÖ `get_user_timezone` –∏ `get_user_timezone_or_default` –≤ `moviebot/database/db_operations.py`
- ‚úÖ `set_user_timezone` –≤ `moviebot/database/db_operations.py`
- ‚úÖ `PLANS_TZ = pytz.timezone('Europe/Moscow')` –≤ `moviebot/config.py`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –≤ `series.py` (—Å—Ç—Ä–æ–∫–∞ 446)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `get_user_timezone_or_default` –≤ `plan.py` –∏ `scheduler.py`
- ‚úÖ `check_timezone_change` –≤ `moviebot/utils/parsing.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
- ‚úÖ `show_timezone_selection` –≤ `moviebot/utils/parsing.py` –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤—ã–±–æ—Ä–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞

### –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ú–æ—Å–∫–≤–∞ (Europe/Moscow)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å: –°–µ—Ä–±–∏—è (Europe/Belgrade)
- –í—Å–µ –ø–ª–∞–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ UTC –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

## ‚ö†Ô∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ñ–∏–ª—å–º–∞ - –ß–ê–°–¢–ò–ß–ù–û –ü–ï–†–ï–ù–ï–°–ï–ù–û

### –ß—Ç–æ –µ—Å—Ç—å:
- ‚úÖ `user_edit_state` –≤ `moviebot/states.py`
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å" –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ (`series.py` —Å—Ç—Ä–æ–∫–∞ 940)
- ‚úÖ Callback `edit_plan:` —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

### –ß—Ç–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
- ‚ùå **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `edit_plan:` callback –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù**
- ‚ùå **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ù–ï –ü–ï–†–ï–ù–ï–°–ï–ù**
- –í —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ:
  - `handle_edit_plan_datetime_internal` (—Å—Ç—Ä–æ–∫–∞ 5195)
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –≥–ª–∞–≤–Ω–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (—Å—Ç—Ä–æ–∫–∞ 6574)
- –õ–æ–≥–∏–∫–∞:
  1. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å" —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `user_edit_state[user_id] = {'action': 'edit_plan_datetime', 'plan_id': plan_id}`
  2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
  3. –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ `parse_session_time`
  4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `plan_datetime` –≤ –ë–î
  5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

### –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `edit_plan:` callback
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `user_edit_state` —Å `action == 'edit_plan_datetime'` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
- –§—É–Ω–∫—Ü–∏—è `handle_edit_plan_datetime_internal` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞

## üìã –ò–¢–û–ì–û–í–´–ô –°–¢–ê–¢–£–°

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ:
1. –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ/—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ (–ú–æ—Å–∫–≤–∞/–°–µ—Ä–±–∏—è) - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ:
1. **–§–ª–æ—É –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫** - –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `rating_messages`, –Ω–æ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
2. **–¢–∞–π–º–∏–Ω–≥–∏** - –µ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
3. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è** - –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### ‚ùå –ù–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ:
1. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∞–∫—Ü–∏–π –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
3. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–ª–∞–Ω–∞** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

## üîß –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### 1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–∫—Ü–∏–π
- –°–æ–∑–¥–∞—Ç—å `moviebot/bot/callbacks/reactions_callbacks.py`
- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `handle_reaction` –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `@bot_instance.message_reaction_handler`
- –î–æ–±–∞–≤–∏—Ç—å callback handlers –¥–ª—è `add_emoji:` –∏ `add_custom_emoji:`

### 2. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –æ—Ü–µ–Ω–∫–∞–º–∏
- –í `series.py` –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `rating_messages` –∏ `bot_messages` –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–∑ `handle_rating_internal`

### 3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏
- –í `series.py` –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å `user_settings_state[user_id].get('waiting_notify_time')`
- –ü–∞—Ä—Å–∏—Ç—å –≤—Ä–µ–º—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —á–µ—Ä–µ–∑ `set_notification_setting`

### 4. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–ª–∞–Ω–∞
- –í `plan.py` –∏–ª–∏ `series.py`
- Callback handler –¥–ª—è `edit_plan:`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `user_edit_state` —Å `action == 'edit_plan_datetime'`
- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º –≤—Ä–µ–º–µ–Ω–µ–º

