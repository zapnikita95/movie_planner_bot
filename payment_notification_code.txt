================================================================================
–í–ï–°–¨ –ö–û–î, –°–í–Ø–ó–ê–ù–ù–´–ô –° –û–¢–ü–†–ê–í–ö–û–ô –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –ü–û–°–õ–ï –ü–õ–ê–¢–ï–ñ–ê
================================================================================
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2026-01-04
–§–∞–π–ª: moviebot.py

================================================================================
1. –û–ë–†–ê–ë–û–¢–ß–ò–ö successful_payment
================================================================================

@bot.message_handler(content_types=['successful_payment'], priority=10)
def got_payment(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ successful_payment –¥–ª—è Telegram Stars - –æ—Å–Ω–æ–≤–Ω–æ–π handler –¥–ª—è Stars –ø–ª–∞—Ç–µ–∂–µ–π"""
    try:
        logger.info(f"[STARS SUCCESS] ===== –ü–û–õ–£–ß–ï–ù successful_payment =====")
        logger.info(f"[STARS SUCCESS] ‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–æ—Ç handler –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è Stars –ø–ª–∞—Ç–µ–∂–µ–π!")
        logger.info(f"[STARS SUCCESS] message_id={message.message_id}, date={message.date}")
        logger.info(f"[STARS SUCCESS] from_user.id={message.from_user.id}, from_user.username={message.from_user.username}")
        logger.info(f"[STARS SUCCESS] chat.id={message.chat.id}, chat.type={message.chat.type}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ successful_payment
        if not hasattr(message, 'successful_payment') or not message.successful_payment:
            logger.error(f"[STARS SUCCESS] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: message.successful_payment –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!")
            logger.error(f"[STARS SUCCESS] message.content_type={getattr(message, 'content_type', 'N/A')}")
            logger.error(f"[STARS SUCCESS] message.__dict__={message.__dict__}")
            return
        
        payment = message.successful_payment
        user_id = message.from_user.id
        chat_id = message.chat.id
        
        logger.info(f"[STARS SUCCESS] payment.currency={payment.currency}")
        logger.info(f"[STARS SUCCESS] payment.total_amount={payment.total_amount}")
        logger.info(f"[STARS SUCCESS] payment.invoice_payload={payment.invoice_payload}")
        logger.info(f"[STARS SUCCESS] payment.telegram_payment_charge_id={getattr(payment, 'telegram_payment_charge_id', 'N/A')}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ Stars (–≤–∞–ª—é—Ç–∞ XTR)
        if payment.currency != 'XTR':
            logger.warning(f"[STARS SUCCESS] ‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ —á–µ—Ä–µ–∑ Stars: currency={payment.currency}")
            logger.warning(f"[STARS SUCCESS] –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É (—ç—Ç–æ –Ω–µ Stars –ø–ª–∞—Ç–µ–∂)")
            return
        
        logger.info(f"[STARS SUCCESS] ‚úÖ –≠—Ç–æ Stars –ø–ª–∞—Ç–µ–∂ (XTR), –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...")
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º payment_id –∏–∑ invoice_payload
        invoice_payload = payment.invoice_payload
        logger.info(f"[STARS SUCCESS] invoice_payload={invoice_payload}")
        
        if not invoice_payload or not invoice_payload.startswith('stars_'):
            logger.error(f"[STARS SUCCESS] ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π invoice_payload: {invoice_payload}")
            logger.error(f"[STARS SUCCESS] –û–∂–∏–¥–∞–ª—Å—è —Ñ–æ—Ä–º–∞—Ç 'stars_<payment_id>'")
            bot.reply_to(message, "‚ùå –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞")
            return
        
        payment_id = invoice_payload.replace('stars_', '')
        logger.info(f"[STARS SUCCESS] ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω payment_id: {payment_id}")
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ –∏–∑ –ë–î
        logger.info(f"[STARS SUCCESS] –ò—â–µ–º –ø–ª–∞—Ç–µ–∂ –≤ –ë–î –ø–æ payment_id={payment_id}")
        from database.db_operations import get_payment_by_id, update_payment_status, create_subscription
        
        # –ò—â–µ–º –ø–ª–∞—Ç–µ–∂ –ø–æ payment_id
        payment_data = None
        try:
            logger.info(f"[STARS SUCCESS] –í—ã–ø–æ–ª–Ω—è–µ–º SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...")
            from database.db_connection import get_db_connection
            conn = get_db_connection()
            cursor = conn.cursor()
            cursor.execute("""
                SELECT payment_id, user_id, chat_id, subscription_type, plan_type, period_type, group_size, amount, status
                FROM payments 
                WHERE payment_id = %s
            """, (payment_id,))
            row = cursor.fetchone()
            if row:
                payment_data = {
                    'payment_id': row[0],
                    'user_id': row[1],
                    'chat_id': row[2],
                    'subscription_type': row[3],
                    'plan_type': row[4],
                    'period_type': row[5],
                    'group_size': row[6],
                    'amount': row[7],
                    'status': row[8]
                }
                logger.info(f"[STARS SUCCESS] ‚úÖ –ü–ª–∞—Ç–µ–∂ –Ω–∞–π–¥–µ–Ω –≤ –ë–î: {payment_data}")
            else:
                logger.warning(f"[STARS SUCCESS] ‚ö†Ô∏è –ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î (row=None)")
            cursor.close()
        except Exception as e:
            logger.error(f"[STARS SUCCESS] ‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –∏–∑ –ë–î: {e}", exc_info=True)
        
        if not payment_data:
            logger.error(f"[STARS SUCCESS] ‚ùå –ü–ª–∞—Ç–µ–∂ {payment_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î")
            logger.error(f"[STARS SUCCESS] –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
            logger.error(f"[STARS SUCCESS]   1. –ü–ª–∞—Ç–µ–∂ –Ω–µ –±—ã–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ invoice")
            logger.error(f"[STARS SUCCESS]   2. payment_id –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç")
            logger.error(f"[STARS SUCCESS]   3. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ë–î")
            bot.reply_to(message, "‚ùå –û—à–∏–±–∫–∞: –ø–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö")
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–ª–∞—Ç–µ–∂ –µ—â–µ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
        logger.info(f"[STARS SUCCESS] –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞: {payment_data['status']}")
        if payment_data['status'] == 'succeeded':
            logger.warning(f"[STARS SUCCESS] ‚ö†Ô∏è –ü–ª–∞—Ç–µ–∂ {payment_id} —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–∞–Ω–µ–µ")
            bot.reply_to(message, "‚úÖ –ü–ª–∞—Ç–µ–∂ —É–∂–µ –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ä–∞–Ω–µ–µ")
            return
        
        logger.info(f"[STARS SUCCESS] –ü–ª–∞—Ç–µ–∂ –Ω–∞–π–¥–µ–Ω, —Å—Ç–∞—Ç—É—Å={payment_data['status']}, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...")
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
        logger.info(f"[STARS SUCCESS] –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ 'succeeded'...")
        try:
            from database.db_connection import get_db_connection
            conn = get_db_connection()
            cursor = conn.cursor()
            cursor.execute("""
                UPDATE payments 
                SET status = 'succeeded'
                WHERE payment_id = %s
            """, (payment_id,))
            conn.commit()
            cursor.close()
            logger.info(f"[STARS SUCCESS] ‚úÖ –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ {payment_id} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ 'succeeded'")
        except Exception as e:
            logger.error(f"[STARS SUCCESS] ‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞: {e}", exc_info=True)
        
        # –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø—Ä–æ–¥–ª–µ–≤–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É
        logger.info(f"[STARS SUCCESS] –°–æ–∑–¥–∞–µ–º/–ø—Ä–æ–¥–ª–µ–≤–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É...")
        logger.info(f"[STARS SUCCESS] subscription_type={payment_data['subscription_type']}")
        logger.info(f"[STARS SUCCESS] plan_type={payment_data['plan_type']}")
        logger.info(f"[STARS SUCCESS] period_type={payment_data['period_type']}")
        logger.info(f"[STARS SUCCESS] group_size={payment_data.get('group_size')}")
        try:
            logger.info(f"[STARS SUCCESS] –í—ã–∑—ã–≤–∞–µ–º create_subscription —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:")
            logger.info(f"[STARS SUCCESS]   user_id={payment_data['user_id']}")
            logger.info(f"[STARS SUCCESS]   chat_id={payment_data['chat_id']}")
            logger.info(f"[STARS SUCCESS]   subscription_type={payment_data['subscription_type']}")
            logger.info(f"[STARS SUCCESS]   plan_type={payment_data['plan_type']}")
            logger.info(f"[STARS SUCCESS]   period_type={payment_data['period_type']}")
            logger.info(f"[STARS SUCCESS]   group_size={payment_data['group_size']}")
            logger.info(f"[STARS SUCCESS]   price={payment_data['amount']}")
            
            subscription_id = create_subscription(
                user_id=payment_data['user_id'],
                chat_id=payment_data['chat_id'],
                subscription_type=payment_data['subscription_type'],
                plan_type=payment_data['plan_type'],
                period_type=payment_data['period_type'],
                group_size=payment_data['group_size'],
                price=payment_data['amount']
            )
            
            logger.info(f"[STARS SUCCESS] ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞/–ø—Ä–æ–¥–ª–µ–Ω–∞: subscription_id={subscription_id}")
            
            # ========================================================================
            # –û–¢–ü–†–ê–í–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ
            # ========================================================================
            text = "‚úÖ <b>–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>\n\n"
            text += f"üí∞ –û–ø–ª–∞—á–µ–Ω–æ: {payment.total_amount}‚≠ê ({payment_data['amount']}‚ÇΩ)\n"
            text += f"üìã –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞\n\n"
            text += "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É! üéâ"
            
            logger.info(f"[STARS SUCCESS] ===== –ù–ê–ß–ê–õ–û –û–¢–ü–†–ê–í–ö–ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø =====")
            logger.info(f"[STARS SUCCESS] –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è: {text}")
            logger.info(f"[STARS SUCCESS] chat_id={chat_id}, user_id={user_id}")
            logger.info(f"[STARS SUCCESS] message.message_id={message.message_id}")
            logger.info(f"[STARS SUCCESS] –í—ã–∑—ã–≤–∞–µ–º bot.reply_to(message, text, parse_mode='HTML')...")
            
            try:
                sent_message = bot.reply_to(message, text, parse_mode='HTML')
                logger.info(f"[STARS SUCCESS] ‚úÖ‚úÖ‚úÖ –°–û–û–ë–©–ï–ù–ò–ï –£–°–ü–ï–®–ù–û –û–¢–ü–†–ê–í–õ–ï–ù–û! ‚úÖ‚úÖ‚úÖ")
                logger.info(f"[STARS SUCCESS] sent_message.message_id={sent_message.message_id if sent_message else 'None'}")
                logger.info(f"[STARS SUCCESS] sent_message.chat.id={sent_message.chat.id if sent_message and hasattr(sent_message, 'chat') else 'None'}")
                logger.info(f"[STARS SUCCESS] ===== –û–¢–ü–†–ê–í–ö–ê –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û =====")
            except Exception as send_error:
                logger.error(f"[STARS SUCCESS] ‚ùå‚ùå‚ùå –û–®–ò–ë–ö–ê –û–¢–ü–†–ê–í–ö–ò –°–û–û–ë–©–ï–ù–ò–Ø! ‚ùå‚ùå‚ùå")
                logger.error(f"[STARS SUCCESS] –¢–∏–ø –æ—à–∏–±–∫–∏: {type(send_error).__name__}")
                logger.error(f"[STARS SUCCESS] –°–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏: {str(send_error)}")
                logger.error(f"[STARS SUCCESS] Traceback:", exc_info=True)
                # –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ã—á–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
                try:
                    logger.info(f"[STARS SUCCESS] –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ bot.send_message...")
                    sent_message = bot.send_message(chat_id, text, parse_mode='HTML')
                    logger.info(f"[STARS SUCCESS] ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ send_message: message_id={sent_message.message_id}")
                except Exception as send_error2:
                    logger.error(f"[STARS SUCCESS] ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ send_message: {send_error2}", exc_info=True)
            
            logger.info(f"[STARS SUCCESS] ===== –û–ë–†–ê–ë–û–¢–ö–ê successful_payment –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û =====")
            
        except Exception as e:
            logger.error(f"[STARS SUCCESS] ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏: {e}", exc_info=True)
            logger.error(f"[STARS SUCCESS] payment_data={payment_data}")
            bot.reply_to(message, "‚ùå –û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        
    except Exception as e:
        logger.error(f"[STARS SUCCESS] ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –æ–±—Ä–∞–±–æ—Ç–∫–∏ successful_payment: {e}", exc_info=True)
        logger.error(f"[STARS SUCCESS] –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
        logger.error(f"[STARS SUCCESS] –°–æ–æ–±—â–µ–Ω–∏–µ: {str(e)}")
        try:
            bot.reply_to(message, "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        except Exception as e2:
            logger.error(f"[STARS SUCCESS] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ: {e2}")

================================================================================
2. –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –í WEBHOOK (web/web_app.py)
================================================================================

# –í —Ñ—É–Ω–∫—Ü–∏–∏ webhook(), –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ update:

# –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ successful_payment –Ω–∞ —É—Ä–æ–≤–Ω–µ update
if hasattr(update, 'message') and update.message and hasattr(update.message, 'successful_payment') and update.message.successful_payment:
    logger.info(f"[WEBHOOK] ‚≠ê‚≠ê‚≠ê –û–ë–ù–ê–†–£–ñ–ï–ù successful_payment –ù–ê –£–†–û–í–ù–ï UPDATE! ‚≠ê‚≠ê‚≠ê")
    logger.info(f"[WEBHOOK] successful_payment.currency={update.message.successful_payment.currency}")
    logger.info(f"[WEBHOOK] successful_payment.total_amount={update.message.successful_payment.total_amount}")
    logger.info(f"[WEBHOOK] successful_payment.invoice_payload={update.message.successful_payment.invoice_payload}")
    logger.info(f"[WEBHOOK] successful_payment.telegram_payment_charge_id={getattr(update.message.successful_payment, 'telegram_payment_charge_id', 'N/A')}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ pre_checkout_query (—Ö–æ—Ç—è –¥–ª—è Stars –Ω–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏)
if hasattr(update, 'pre_checkout_query') and update.pre_checkout_query:
    logger.info(f"[WEBHOOK] ‚ö†Ô∏è PRE CHECKOUT QUERY –ø—Ä–∏—à–µ–ª! (—Ö–æ—Ç—è –¥–ª—è Stars –Ω–µ –¥–æ–ª–∂–µ–Ω)")
    logger.info(f"[WEBHOOK] pre_checkout_query.currency={update.pre_checkout_query.currency}")
    logger.info(f"[WEBHOOK] pre_checkout_query.invoice_payload={update.pre_checkout_query.invoice_payload}")

# –õ–æ–≥–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–ø–ª–∞–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
if update.message:
    logger.info(f"[WEBHOOK] Update.message.content_type={update.message.content_type if hasattr(update.message, 'content_type') else '–ù–ï–¢'}")
    logger.info(f"[WEBHOOK] Update.message.text='{update.message.text[:200] if update.message.text else None}'")
    logger.info(f"[WEBHOOK] Update.message.from_user.id={update.message.from_user.id if update.message.from_user else None}")
    
    # –ö–†–ò–¢–ò–ß–ù–û: –õ–æ–≥–∏—Ä—É–µ–º successful_payment –µ—Å–ª–∏ –µ—Å—Ç—å
    if hasattr(update.message, 'successful_payment') and update.message.successful_payment:
        logger.info(f"[WEBHOOK] ‚≠ê‚≠ê‚≠ê –û–ë–ù–ê–†–£–ñ–ï–ù successful_payment! ‚≠ê‚≠ê‚≠ê")
        logger.info(f"[WEBHOOK] successful_payment.currency={update.message.successful_payment.currency}")
        logger.info(f"[WEBHOOK] successful_payment.total_amount={update.message.successful_payment.total_amount}")
        logger.info(f"[WEBHOOK] successful_payment.invoice_payload={update.message.successful_payment.invoice_payload}")
        logger.info(f"[WEBHOOK] successful_payment.telegram_payment_charge_id={getattr(update.message.successful_payment, 'telegram_payment_charge_id', 'N/A')}")

================================================================================
3. –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø
================================================================================

‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ successful_payment –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ webhook, –Ω–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ got_payment –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. Priority –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π (—Ö–æ—Ç—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω priority=10)
3. content_types –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –¥—Ä—É–≥–∏–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

‚úÖ –ß–¢–û –î–ï–õ–ê–ï–¢ –ö–û–î:
1. –ü–æ–ª—É—á–∞–µ—Ç successful_payment –∏–∑ message
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —ç—Ç–æ Stars –ø–ª–∞—Ç–µ–∂ (currency='XTR')
3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç payment_id –∏–∑ invoice_payload
4. –ò—â–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ë–î
5. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –Ω–∞ 'succeeded'
6. –°–æ–∑–¥–∞–µ—Ç/–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ create_subscription
7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ bot.reply_to()

‚úÖ –õ–û–ì–ò–†–û–í–ê–ù–ò–ï:
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —à–∞–≥ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –¥–µ—Ç–∞–ª—è–º–∏ (message_id, chat_id)
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø–æ–ª–Ω—ã–º traceback
- –ü—Ä–∏ –æ—à–∏–±–∫–µ reply_to –ø—Ä–æ–±—É–µ—Ç—Å—è send_message –∫–∞–∫ fallback

================================================================================
–ö–û–ù–ï–¶ –§–ê–ô–õ–ê
================================================================================





