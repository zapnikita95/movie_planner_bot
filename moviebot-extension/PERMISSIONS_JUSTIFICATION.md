# Обоснование разрешений для Chrome Web Store

## Разрешения, используемые в расширении

### 1. `storage`
**Использование:** 
- Сохранение привязки аккаунта Telegram (`linked_chat_id`, `linked_user_id`)
- Кэширование последних 100 просмотров фильмов/сериалов для оптимизации запросов к API
- Сохранение позиции плавающих кнопок (билеты, отслеживание просмотра)

**Где используется:**
- `popup.js`: `chrome.storage.local.get/set` для привязки аккаунта
- `content-streaming.js`: кэш просмотров (`movieplanner_streaming_cache`), позиция плашки
- `content-tickets.js`: позиция кнопки добавления билетов

### 2. `activeTab`
**Использование:**
- Получение URL текущей вкладки для определения фильма/сериала на странице
- Открытие popup расширения программно

**Где используется:**
- `popup.js`: `chrome.tabs.query({ active: true, currentWindow: true })` для получения URL текущей вкладки
- `background.js`: `chrome.action.openPopup()` для открытия popup

### 3. `contextMenus`
**Использование:**
- Добавление пункта контекстного меню для быстрого добавления фильма в базу

**Где используется:**
- `background.js`: `chrome.contextMenus.create()` для создания пункта меню

### 4. `notifications`
**Использование:**
- Уведомления пользователю о важных событиях (например, успешное добавление фильма)

**Где используется:**
- `background.js`: `chrome.notifications.create()` для показа уведомлений

### 5. `tabs`
**Использование:**
- Получение информации о текущей вкладке (URL, заголовок)
- Открытие popup расширения программно

**Где используется:**
- `popup.js`: `chrome.tabs.query()` для получения URL текущей вкладки
- `background.js`: `chrome.action.openPopup()` для открытия popup

## Разрешение `scripting` НЕ используется

Разрешение `scripting` **отсутствует** в `manifest.json` и **не используется** в коде расширения.

Все необходимые функции реализованы через:
- **Content Scripts** (`content_scripts` в `manifest.json`) - для взаимодействия с DOM страниц
- **Background Service Worker** (`background.js`) - для обработки сообщений между компонентами
- **Popup** (`popup.html/popup.js`) - для пользовательского интерфейса

Расширение не требует динамической инъекции скриптов в контекст страницы, поэтому разрешение `scripting` не запрашивается.

## Host Permissions

Все указанные домены используются для:
- **Кинопоиск, IMDb, Letterboxd** - парсинг информации о фильмах
- **Стриминговые платформы** (Иви, Твоё, Амедиатека и другие) - отслеживание просмотра фильмов/сериалов
- **Билетные сайты** (karofilm.ru, mos-kino.ru) - добавление билетов к планам
- **Backend API** (web-production-3921c.up.railway.app) - взаимодействие с сервером бота
